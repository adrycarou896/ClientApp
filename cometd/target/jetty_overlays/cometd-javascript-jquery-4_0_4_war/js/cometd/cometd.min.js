var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(g,y,n){g instanceof String&&(g=String(g));for(var q=g.length,F=0;F<q;F++){var C=g[F];if(y.call(n,C,F,g))return{i:F,v:C}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,y,n){g!=Array.prototype&&g!=Object.prototype&&(g[y]=n.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(g,y,n,q){if(y){n=$jscomp.global;g=g.split(".");for(q=0;q<g.length-1;q++){var F=g[q];F in n||(n[F]={});n=n[F]}g=g[g.length-1];q=n[g];y=y(q);y!=q&&null!=y&&$jscomp.defineProperty(n,g,{configurable:!0,writable:!0,value:y})}};$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(g,n){return $jscomp.findInternal(this,g,n).v}},"es6","es3");
(function(g,y){var n=this.cometdRuntime;n||(n=window);"object"===typeof exports?module.exports=y(n):"function"===typeof define&&define.amd?define([],function(){return y(n)}):(g.org=g.org||{},g.org.cometd=y(n))})(this,function(g){function y(){var f={};self.onmessage=function(d){var b=d.data;d=f[b.id];switch(b.type){case "setTimeout":f[b.id]=self.setTimeout(function(){delete f[b.id];self.postMessage({id:b.id})},b.delay);break;case "clearTimeout":delete f[b.id];d&&self.clearTimeout(d);break;default:throw"Unknown command "+
b.type;}}}var n=function(){var f=0,d={};this.register=function(b){var c=++f;d[c]=b;return c};this.unregister=function(b){var c=d[b];delete d[b];return c};this.setTimeout=function(b,c){return g.setTimeout(b,c)};this.clearTimeout=function(b){g.clearTimeout(b)}},q={isString:function(f){return void 0===f||null===f?!1:"string"===typeof f||f instanceof String},isArray:function(f){return void 0===f||null===f?!1:f instanceof Array},inArray:function(f,d){for(var b=0;b<d.length;++b)if(f===d[b])return b;return-1}},
F=function(){var f=[],d={};this.getTransportTypes=function(){return f.slice(0)};this.findTransportTypes=function(b,c,m){for(var e=[],w=0;w<f.length;++w){var k=f[w];!0===d[k].accept(b,c,m)&&e.push(k)}return e};this.negotiateTransport=function(b,c,m,e){for(var w=0;w<f.length;++w)for(var k=f[w],g=0;g<b.length;++g)if(k===b[g]){var r=d[k];if(!0===r.accept(c,m,e))return r}return null};this.add=function(b,c,m){for(var e=!1,g=0;g<f.length;++g)if(f[g]===b){e=!0;break}e||("number"!==typeof m?f.push(b):f.splice(m,
0,b),d[b]=c);return!e};this.find=function(b){for(var c=0;c<f.length;++c)if(f[c]===b)return d[b];return null};this.remove=function(b){for(var c=0;c<f.length;++c)if(f[c]===b)return f.splice(c,1),c=d[b],delete d[b],c;return null};this.clear=function(){f=[];d={}};this.reset=function(b){for(var c=0;c<f.length;++c)d[f[c]].reset(b)}},C=function(){var f,d,b;this.registered=function(c,b){f=c;d=b};this.unregistered=function(){d=f=null};this._debug=function(){d._debug.apply(d,arguments)};this._mixin=function(){return d._mixin.apply(d,
arguments)};this.getConfiguration=function(){return d.getConfiguration()};this.getAdvice=function(){return d.getAdvice()};this.setTimeout=function(c,b){return d.setTimeout(c,b)};this.clearTimeout=function(c){d.clearTimeout(c)};this.convertToMessages=function(c){if(q.isString(c))try{return JSON.parse(c)}catch(m){throw this._debug("Could not convert to JSON the following string",'"'+c+'"'),m;}if(q.isArray(c))return c;if(void 0===c||null===c)return[];if(c instanceof Object)return[c];throw"Conversion Error "+
c+", typeof "+typeof c;};this.accept=function(c,b,e){throw"Abstract";};this.getType=function(){return f};this.getURL=function(){return b};this.setURL=function(c){b=c};this.send=function(c,b){throw"Abstract";};this.reset=function(c){this._debug("Transport",f,"reset",c?"initial":"retry")};this.abort=function(){this._debug("Transport",f,"aborted")};this.toString=function(){return this.getType()}};C.derive=function(f){function d(){}d.prototype=f;return new d};var T=function(){function f(c){for(;0<r.length;){var b=
r[0],e=b[0];b=b[1];if(e.url===c.url&&e.sync===c.sync)r.shift(),c.messages=c.messages.concat(e.messages),this._debug("Coalesced",e.messages.length,"messages from request",b.id);else break}}function d(c,b){this.transportSend(c,b);b.expired=!1;if(!c.sync){var e=this.getConfiguration().maxNetworkDelay,d=e;!0===b.metaConnect&&(d+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",e);var f=this;b.timeout=this.setTimeout(function(){b.expired=
!0;var u="Request "+b.id+" of transport "+f.getType()+" exceeded "+d+" ms max network delay",e={reason:u},p=b.xhr;e.httpCode=f.xhrStatus(p);f.abortXHR(p);f._debug(u);f.complete(b,!1,b.metaConnect);c.onFailure(p,c.messages,e)},d)}}function b(b){var c=++w,e={id:c,metaConnect:!1,envelope:b};A.length<this.getConfiguration().maxConnections-1?(A.push(e),d.call(this,b,e)):(this._debug("Transport",this.getType(),"queueing request",c,"envelope",b),r.push([b,e]))}function c(c,e){var d=q.inArray(c,A);0<=d&&
A.splice(d,1);if(0<r.length){d=r.shift();var m=d[0],p=d[1];this._debug("Transport dequeued request",p.id);if(e)this.getConfiguration().autoBatch&&f.call(this,m),b.call(this,m),this._debug("Transport completed request",c.id,m);else{var u=this;this.setTimeout(function(){u.complete(p,!1,p.metaConnect);var b={reason:"Previous request failed"},c=p.xhr;b.httpCode=u.xhrStatus(c);m.onFailure(c,m.messages,b)},0)}}}var m=new C,e=C.derive(m),w=0,k=null,A=[],r=[];e.complete=function(b,e,d){if(d){b=b.id;this._debug("Transport",
this.getType(),"/meta/connect complete, request",b);if(null!==k&&k.id!==b)throw"/meta/connect request mismatch, completing request "+b;k=null}else c.call(this,b,e)};e.transportSend=function(b,c){throw"Abstract";};e.transportSuccess=function(b,c,e){if(!c.expired)if(this.clearTimeout(c.timeout),this.complete(c,!0,c.metaConnect),e&&0<e.length)b.onSuccess(e);else b.onFailure(c.xhr,b.messages,{httpCode:204})};e.transportFailure=function(b,c,e){c.expired||(this.clearTimeout(c.timeout),this.complete(c,!1,
c.metaConnect),b.onFailure(c.xhr,b.messages,e))};e.send=function(c,e){if(e){if(null!==k)throw"Concurrent /meta/connect requests not allowed, request id="+k.id+" not yet completed";e=++w;this._debug("Transport",this.getType(),"/meta/connect send, request",e,"envelope",c);e={id:e,metaConnect:!0,envelope:c};d.call(this,c,e);k=e}else b.call(this,c)};e.abort=function(){m.abort();for(var c=0;c<A.length;++c){var b=A[c];b&&(this._debug("Aborting request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,
b,{reason:"abort"}))}if(c=k)this._debug("Aborting /meta/connect request",c),this.abortXHR(c.xhr)||this.transportFailure(c.envelope,c,{reason:"abort"});this.reset(!0)};e.reset=function(c){m.reset(c);k=null;A=[];r=[]};e.abortXHR=function(c){if(c)try{var b=c.readyState;c.abort();return b!==g.XMLHttpRequest.UNSENT}catch(Ha){this._debug(Ha)}return!1};e.xhrStatus=function(c){if(c)try{return c.status}catch(t){this._debug(t)}return-1};return e},pa=function(){var f=new T,d=C.derive(f),b=!0;d.accept=function(c,
d,e){return b||!d};d.newXMLHttpRequest=function(){return new g.XMLHttpRequest};d.xhrSend=function(c){var b=d.newXMLHttpRequest();b.context=d.context;b.withCredentials=!0;b.open("POST",c.url,!0!==c.sync);var e=c.headers;if(e)for(var f in e)e.hasOwnProperty(f)&&b.setRequestHeader(f,e[f]);b.setRequestHeader("Content-Type","application/json;charset=UTF-8");b.onload=function(){if(200===b.status)c.onSuccess(b.responseText);else c.onError(b.statusText)};b.onerror=function(){c.onError(b.statusText)};b.send(c.body);
return b};d.transportSend=function(c,d){this._debug("Transport",this.getType(),"sending request",d.id,"envelope",c);var e=this;try{var f=!0;d.xhr=this.xhrSend({transport:this,url:c.url,sync:c.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(c.messages),onSuccess:function(f){e._debug("Transport",e.getType(),"received response",f);var g=!1;try{var k=e.convertToMessages(f);0===k.length?(b=!1,e.transportFailure(c,d,{httpCode:204})):(g=!0,e.transportSuccess(c,d,k))}catch(p){e._debug(p),
g||(b=!1,f={exception:p},f.httpCode=e.xhrStatus(d.xhr),e.transportFailure(c,d,f))}},onError:function(g,m){e._debug("Transport",e.getType(),"received error",g,m);b=!1;var k={reason:g,exception:m};k.httpCode=e.xhrStatus(d.xhr);f?e.setTimeout(function(){e.transportFailure(c,d,k)},0):e.transportFailure(c,d,k)}});f=!1}catch(k){b=!1,this.setTimeout(function(){e.transportFailure(c,d,{exception:k})},0)}};d.reset=function(c){f.reset(c);b=!0};return d},qa=function(){function f(b,d,e){var c=this;return function(){c.transportFailure(b,
d,"error",e)}}var d=new T;d=C.derive(d);var b=0;d.accept=function(b,d,e){return!0};d.jsonpSend=function(c){var d=document.getElementsByTagName("head")[0],e=document.createElement("script"),f="_cometd_jsonp_"+b++;g[f]=function(b){d.removeChild(e);delete g[f];c.onSuccess(b)};var k=c.url;k+=0>k.indexOf("?")?"?":"&";k=k+("jsonp="+f)+("&message="+encodeURIComponent(c.body));e.src=k;e.async=!0!==c.sync;e.type="application/javascript";e.onerror=function(b){c.onError("jsonp "+b.type)};d.appendChild(e)};d.transportSend=
function(b,d){for(var c=this,g=0,k=b.messages.length,m=[];0<k;){var r=JSON.stringify(b.messages.slice(g,g+k));r=b.url.length+encodeURI(r).length;var p=this.getConfiguration().maxURILength;if(r>p){if(1===k){m="Bayeux message too big ("+r+" bytes, max is "+p+") for transport "+this.getType();this.setTimeout(f.call(this,b,d,m),0);return}--k}else m.push(k),g+=k,k=b.messages.length-g}var t=b;if(1<m.length)for(g=0,k=m[0],this._debug("Transport",this.getType(),"split",b.messages.length,"messages into",m.join(" + ")),
t=this._mixin(!1,{},b),t.messages=b.messages.slice(g,k),t.onSuccess=b.onSuccess,t.onFailure=b.onFailure,r=1;r<m.length;++r)p=this._mixin(!1,{},b),g=k,k+=m[r],p.messages=b.messages.slice(g,k),p.onSuccess=b.onSuccess,p.onFailure=b.onFailure,this.send(p,d.metaConnect);this._debug("Transport",this.getType(),"sending request",d.id,"envelope",t);try{var q=!0;this.jsonpSend({transport:this,url:t.url,sync:t.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(t.messages),onSuccess:function(b){var e=
!1;try{var f=c.convertToMessages(b);0===f.length?c.transportFailure(t,d,{httpCode:204}):(e=!0,c.transportSuccess(t,d,f))}catch(D){c._debug(D),e||c.transportFailure(t,d,{exception:D})}},onError:function(b,e){var f={reason:b,exception:e};q?c.setTimeout(function(){c.transportFailure(t,d,f)},0):c.transportFailure(t,d,f)}});q=!1}catch(Y){this.setTimeout(function(){c.transportFailure(t,d,{exception:Y})},0)}};return d},ta=function(){function f(b,c){b&&(this.webSocketClose(b,c.code,c.reason),this.onClose(b,
c))}function d(b,c,d){for(var e=[],f=0;f<c.messages.length;++f){var u=c.messages[f];u.id&&e.push(u.id)}b.envelopes[e.join(",")]=[c,d];this._debug("Transport",this.getType(),"stored envelope, envelopes",b.envelopes)}function b(b){if(!n){var c=k.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",c);try{var d=k.getConfiguration().protocol;b.webSocket=d?new g.WebSocket(c,d):new g.WebSocket(c);n=b}catch(M){throw A=!1,this._debug("Exception while creating WebSocket object",
M),M;}p=!1!==k.getConfiguration().stickyReconnect;var e=this,u=k.getConfiguration().connectTimeout;0<u&&(b.connectTimer=this.setTimeout(function(){k._debug("Transport",e.getType(),"timed out while connecting to URL",c,":",u,"ms");f.call(e,b,{code:1E3,reason:"Connect Timeout"})},u));var m=function(c){c=c||{code:1E3};k._debug("WebSocket onclose",b,c,"connecting",n,"current",t);b.connectTimer&&e.clearTimeout(b.connectTimer);e.onClose(b,c)};b.webSocket.onopen=function(){k._debug("WebSocket onopen",b);
b.connectTimer&&e.clearTimeout(b.connectTimer);b===n||b===t?(n=null,t=b,r=!0,e.onOpen(b)):(k._warn("Closing extra WebSocket connection",this,"active connection",t),f.call(e,b,{code:1E3,reason:"Extra Connection"}))};b.webSocket.onclose=m;b.webSocket.onerror=function(){m({code:1E3,reason:"Error"})};b.webSocket.onmessage=function(c){k._debug("WebSocket onmessage",c,b);e.onMessage(b,c)};this._debug("Transport",this.getType(),"configured callbacks on",b)}}function c(b,c,d){var e=JSON.stringify(c.messages);
b.webSocket.send(e);this._debug("Transport",this.getType(),"sent",c,"/meta/connect =",d);var g=e=this.getConfiguration().maxNetworkDelay;d&&(g+=this.getAdvice().timeout,y=!0);for(var u=this,m=[],D=0;D<c.messages.length;++D)(function(){var d=c.messages[D];d.id&&(m.push(d.id),b.timeouts[d.id]=u.setTimeout(function(){k._debug("Transport",u.getType(),"timing out message",d.id,"after",g,"on",b);f.call(u,b,{code:1E3,reason:"Message Timeout"})},g))})();this._debug("Transport",this.getType(),"waiting at most",
g,"ms for messages",m,"maxNetworkDelay",e,", timeouts:",b.timeouts)}function m(e,g,k){try{null===e?(e=n||{envelopes:{},timeouts:{}},d.call(this,e,g,k),b.call(this,e)):(d.call(this,e,g,k),c.call(this,e,g,k))}catch(U){var u=this;this.setTimeout(function(){f.call(u,e,{code:1E3,reason:"Exception",exception:U})},0)}}var e=new C,w=C.derive(e),k,A=!0,r=!1,p=!0,t=null,n=null,y=!1,z=null;w.reset=function(b){e.reset(b);A=!0;b&&(r=!1);p=!0;n=t=null;y=!1};w._notifySuccess=function(b,c){b.call(this,c)};w._notifyFailure=
function(b,c,d,e){b.call(this,c,d,e)};w.onOpen=function(b){var d=b.envelopes;this._debug("Transport",this.getType(),"opened",b,"pending messages",d);for(var e in d)if(d.hasOwnProperty(e)){var f=d[e],g=f[0];f=f[1];z=g.onSuccess;c.call(this,b,g,f)}};w.onMessage=function(b,c){this._debug("Transport",this.getType(),"received websocket message",c,b);var d=!1;c=this.convertToMessages(c.data);for(var e=[],f=0;f<c.length;++f){var g=c[f];if((/^\/meta\//.test(g.channel)||void 0===g.data)&&g.id){e.push(g.id);
var k=b.timeouts[g.id];k&&(this.clearTimeout(k),delete b.timeouts[g.id],this._debug("Transport",this.getType(),"removed timeout for message",g.id,", timeouts",b.timeouts))}"/meta/connect"===g.channel&&(y=!1);"/meta/disconnect"!==g.channel||y||(d=!0)}f=!1;g=b.envelopes;for(k=0;k<e.length;++k){var m=e[k],u;for(u in g)if(g.hasOwnProperty(u)){var p=u.split(","),n=q.inArray(m,p);if(0<=n){f=!0;p.splice(n,1);m=g[u][0];n=g[u][1];delete g[u];0<p.length&&(g[p.join(",")]=[m,n]);break}}}f&&this._debug("Transport",
this.getType(),"removed envelope, envelopes",g);this._notifySuccess(z,c);d&&this.webSocketClose(b,1E3,"Disconnect")};w.onClose=function(b,c){this._debug("Transport",this.getType(),"closed",b,c);if(b===n||b===t)A=p&&r,t=n=null;var d=b.timeouts;b.timeouts={};for(var e in d)d.hasOwnProperty(e)&&this.clearTimeout(d[e]);d=b.envelopes;b.envelopes={};for(var f in d)if(d.hasOwnProperty(f)){e=d[f][0];d[f][1]&&(y=!1);var g={websocketCode:c.code,reason:c.reason};c.exception&&(g.exception=c.exception);this._notifyFailure(e.onFailure,
b,e.messages,g)}};w.registered=function(b,c){e.registered(b,c);k=c};w.accept=function(b,c,d){this._debug("Transport",this.getType(),"accept, supported:",A);return A&&!!g.WebSocket&&!1!==k.websocketEnabled};w.send=function(b,c){this._debug("Transport",this.getType(),"sending",b,"/meta/connect =",c);m.call(this,t,b,c)};w.webSocketClose=function(b,c,d){try{b.webSocket&&b.webSocket.close(c,d)}catch(da){this._debug(da)}};w.abort=function(){e.abort();f.call(this,t,{code:1E3,reason:"Abort"});this.reset(!0)};
return w},O="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),ia=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(f){function d(a,b){try{return a[b]}catch(K){}}function b(a){return void 0===a||null===a?!1:"function"===
typeof a}function c(a,b){for(var c="";0<--b&&!(a>=Math.pow(10,b));)c+="0";return c+a}function m(a,l){if(g.console&&(a=g.console[a],b(a))){var d=new Date;[].splice.call(l,0,0,c(d.getHours(),2)+":"+c(d.getMinutes(),2)+":"+c(d.getSeconds(),2)+"."+c(d.getMilliseconds(),3));a.apply(g.console,l)}}function e(a){return/(^https?:\/\/)?(((\[[^\]]+])|([^:/?#]+))(:(\d+))?)?([^?#]*)(.*)?/.exec(a)}function w(a){h._debug("Configuring cometd object with",a);q.isString(a)&&(a={url:a});a||(a={});x=h._mixin(!1,x,a);
a=h.getURL();if(!a)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=e(a);a=b[8];var c=b[9];ea=h._isCrossDomain(b[2]);x.appendMessageTypeToURL&&(void 0!==c&&0<c.length?(h._info("Appending message type to URI "+a+c+" is not supported, disabling 'appendMessageTypeToURL' configuration"),x.appendMessageTypeToURL=!1):(b=a.split("/"),c=b.length-1,a.match(/\/$/)&&--c,0<=b[c].indexOf(".")&&(h._info("Appending message type to URI "+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),
x.appendMessageTypeToURL=!1)));if(g.Worker&&g.Blob&&g.URL&&x.useWorkerScheduler){a=y.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));a=new g.Blob([a],{type:"application/json"});a=g.URL.createObjectURL(a);var d=new g.Worker(a);P.setTimeout=function(a,b){a=P.register(a);d.postMessage({id:a,type:"setTimeout",delay:b});return a};P.clearTimeout=function(a){P.unregister(a);d.postMessage({id:a,type:"clearTimeout"})};d.onmessage=function(a){(a=P.unregister(a.data.id))&&a()}}}function k(a){if(a){var b=
I[a.channel];b&&b[a.id]&&(delete b[a.id],h._debug("Removed",a.listener?"listener":"subscription",a))}}function A(){for(var a in I)if(I.hasOwnProperty(a)){var b=I[a];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&k(d)}}}function r(a){N!==a&&(h._debug("Status",N,"->",a),N=a)}function p(){return"disconnecting"===N||"disconnected"===N}function t(a,c,d,e,f){try{return c.call(a,e)}catch(Q){a=h.onExtensionException;if(b(a)){h._debug("Invoking extension exception handler",d,Q);try{a.call(h,
Q,d,f,e)}catch(ja){h._info("Exception during execution of extension exception handler",d,ja)}}else h._info("Exception during execution of extension",d,Q);return e}}function C(a){for(var c=E.length-1;0<=c&&void 0!==a&&null!==a;--c){var d=E[c],e=d.extension.outgoing;b(e)&&(d=t(d.extension,e,d.name,a,!0),a=void 0===d?a:d)}return a}function Y(a,c){if(a=I[a])for(var d in a)if(a.hasOwnProperty(d)){var l=a[d];if(l)try{l.callback.call(l.scope,c)}catch(Q){var e=h.onListenerException;if(b(e)){h._debug("Invoking listener exception handler",
l,Q);try{e.call(h,Q,l,l.listener,c)}catch(ja){h._info("Exception during execution of listener exception handler",l,ja)}}else h._info("Exception during execution of listener",l,c,Q)}}}function z(a,b){Y(a,b);a=a.split("/");for(var c=a.length-1,l=c;0<l;--l){var d=a.slice(0,l).join("/")+"/*";l===c&&Y(d,b);d+="*";Y(d,b)}}function u(a,b){null!==R&&h.clearTimeout(R);R=null;b=B.interval+b;h._debug("Function scheduled in",b,"ms, interval =",B.interval,"backoff =",G,a);R=h.setTimeout(a,b)}function D(a,b,c){for(var d=
0;d<a.length;++d){var l=a[d],e=l.id;V&&(l.clientId=V);l=C(l);void 0!==l&&null!==l?(l.id=e,a[d]=l):(delete fa[e],a.splice(d--,1))}0!==a.length&&(b&&(aa=a[0]),d=h.getURL(),x.appendMessageTypeToURL&&(d.match(/\/$/)||(d+="/"),c&&(d+=c)),a={url:d,sync:!1,messages:a,onSuccess:function(a){try{Ka.call(h,a)}catch(La){h._info("Exception during handling of messages",La)}},onFailure:function(a,b,c){try{var d=h.getTransport();c.connectionType=d?d.getType():"unknown";ua.call(h,a,b,c)}catch(Ma){h._info("Exception during handling of failure",
Ma)}}},h._debug("Send",a),v.send(a,b))}function Z(a){0<L||!0===ba?W.push(a):D([a],!1)}function da(){var a=W;W=[];0<a.length&&D(a,!1)}function U(a){r("connecting");u(function(){if(!p()){var a={id:""+ ++S,channel:"/meta/connect",connectionType:v.getType()};ha||(a.advice={timeout:0});r("connecting");h._debug("Connect sent",a);D([a],!0,"connect");r("connected")}},a)}function T(a){a&&(B=h._mixin(!1,{},x.advice,a),h._debug("New advice",B))}function M(a){null!==R&&h.clearTimeout(R);R=null;a&&v&&v.abort();
ea=!1;v=null;r("disconnected");V=null;G=L=0;ha=ka=!1;ca=0;aa=null;0<W.length&&(a=W,W=[],ua.call(h,void 0,a,{reason:"Disconnected"}))}function O(a,c,d){var l=h.onTransportException;if(b(l)){h._debug("Invoking transport exception handler",a,c,d);try{l.call(h,d,a,c)}catch(Ja){h._info("Exception during execution of transport exception handler",Ja)}}}function ra(a,c){b(a)&&(c=a,a=void 0);V=null;A();p()&&H.reset(!0);T({});L=0;ba=!0;la=a;va=c;a=h.getURL();var d=H.findTransportTypes("1.0",ea,a),l={id:""+
++S,version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:d,advice:{timeout:B.timeout,interval:B.interval}};l=h._mixin(!1,{},la,l);h._putCallback(l.id,c);if(!v&&(v=H.negotiateTransport(d,"1.0",ea,a),!v))throw c="Could not find initial transport among: "+H.getTransportTypes(),h._warn(c),c;h._debug("Initial transport is",v.getType());r("handshaking");h._debug("Handshake sent",l);D([l],!1,"handshake")}function ia(a){r("handshaking");ba=!0;u(function(){ra(la,va)},a)}function sa(a,
c){try{a.call(h,c)}catch(K){if(a=h.onCallbackException,b(a)){h._debug("Invoking callback exception handler",K);try{a.call(h,K,c)}catch(Ia){h._info("Exception during execution of callback exception handler",Ia)}}else h._info("Exception during execution of message callback",K)}}function J(a){var c=h._getCallback([a.id]);b(c)&&(delete fa[a.id],sa(c,a))}function wa(a){var c=ma[a.id];delete ma[a.id];if(c){h._debug("Handling remote call response for",a,"with context",c);var d=c.timeout;d&&h.clearTimeout(d);
c=c.callback;if(b(c))return sa(c,a),!0}return!1}function xa(a){h._debug("Transport failure handling",a);a.transport&&(v=a.transport);a.url&&v.setURL(a.url);var b=a.action;a=a.delay||0;switch(b){case "handshake":ia(a);break;case "retry":U(a);break;case "none":M(!0);break;default:throw"Unknown action "+b;}}function na(a,b){J(a);z("/meta/handshake",a);z("/meta/unsuccessful",a);p()&&(b.action="none");h.onTransportFailure.call(h,a,b,xa)}function ya(a){return"disconnected"===N?!0:aa&&aa.id===a.id?(aa=null,
!0):!1}function za(a,b){z("/meta/connect",a);z("/meta/unsuccessful",a);p()&&(b.action="none");h.onTransportFailure.call(h,a,b,xa)}function Aa(a){M(!0);J(a);z("/meta/disconnect",a);z("/meta/unsuccessful",a)}function Ba(a){var b=I[a.subscription];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&(delete b[c],h._debug("Removed failed subscription",d))}J(a);z("/meta/subscribe",a);z("/meta/unsuccessful",a)}function Ca(a){J(a);z("/meta/unsubscribe",a);z("/meta/unsuccessful",a)}function oa(a){wa(a)||
(J(a),z("/meta/publish",a),z("/meta/unsuccessful",a))}function Da(a){for(var c=ca=0;c<E.length&&void 0!==a&&null!==a;++c){var d=E[c],f=d.extension.incoming;b(f)&&(d=t(d.extension,f,d.name,a,!1),a=void 0===d?a:d)}if(void 0!==a&&null!==a)switch(T(a.advice),a.channel){case "/meta/handshake":c=h.getURL();if(a.successful)if(d=h._isCrossDomain(e(c)[2]),c=H.negotiateTransport(a.supportedConnectionTypes,a.version,d,c),null===c)a.successful=!1,na(a,{cause:"negotiation",action:"none",transport:null});else switch(v!==
c&&(h._debug("Transport",v.getType(),"->",c.getType()),v=c),V=a.clientId,ba=!1,da(),a.reestablish=ka,ka=!0,J(a),z("/meta/handshake",a),X=a["x-messages"]||0,a=p()?"none":B.reconnect||"retry",a){case "retry":G=0;0===X?U(0):h._debug("Processing",X,"handshake-delivered messages");break;case "none":M(!0);break;default:throw"Unrecognized advice action "+a;}else na(a,{cause:"unsuccessful",action:B.reconnect||"handshake",transport:v});break;case "/meta/connect":if(ya(a))if(ha=a.successful)switch(z("/meta/connect",
a),a=p()?"none":B.reconnect||"retry",a){case "retry":G=0;U(G);break;case "none":M(!1);break;default:throw"Unrecognized advice action "+a;}else za(a,{cause:"unsuccessful",action:B.reconnect||"retry",transport:v});else h._debug("Mismatched /meta/connect reply",a);break;case "/meta/disconnect":a.successful?(M(!1),J(a),z("/meta/disconnect",a)):Aa(a);break;case "/meta/subscribe":a.successful?(J(a),z("/meta/subscribe",a)):Ba(a);break;case "/meta/unsubscribe":a.successful?(J(a),z("/meta/unsubscribe",a)):
Ca(a);break;default:void 0!==a.data?wa(a)||(z(a.channel,a),0<X&&(--X,0===X&&(h._debug("Processed last handshake-delivered message"),U(0)))):void 0===a.successful?h._warn("Unknown Bayeux Message",a):a.successful?(J(a),z("/meta/publish",a)):oa(a)}}function Ea(a){if(a=I[a])for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!0;return!1}function Fa(a,c){var d={scope:a,method:c};if(b(a))d.scope=void 0,d.method=a;else if(q.isString(c)){if(!a)throw"Invalid scope "+a;d.method=a[c];if(!b(d.method))throw"Invalid callback "+
c+" for scope "+a;}else if(!b(c))throw"Invalid callback "+c;return d}function Ga(a,b,c,d){c=Fa(b,c);h._debug("Adding",d?"listener":"subscription","on",a,"with scope",c.scope,"and callback",c.method);b=++Na;c={id:b,channel:a,scope:c.scope,callback:c.method,listener:d};var e=I[a];e||(e={},I[a]=e);e[b]=c;h._debug("Added",d?"listener":"subscription",c);return c}var P=new n,h=this,Oa=f||"default",ea=!1,H=new F,v,N="disconnected",S=0,V=null,L=0,W=[],ba=!1,Na=0,I={},G=0,R=null,E=[],B={},la,va,fa={},ma={},
ka=!1,ha=!1,ca=0,X=0,aa=null,x={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2E3,advice:{timeout:6E4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(a,b,c){for(var e=b||{},f=2;f<arguments.length;++f){var l=arguments[f];if(void 0!==l&&null!==l)for(var g in l)if(l.hasOwnProperty(g)){var h=d(l,
g),k=d(e,g);h!==b&&void 0!==h&&(e[g]=a&&"object"===typeof h&&null!==h?h instanceof Array?this._mixin(a,k instanceof Array?k:[],h):this._mixin(a,"object"!==typeof k||k instanceof Array?{}:k,h):h)}}return e};this._warn=function(){m("warn",arguments)};this._info=function(){"warn"!==x.logLevel&&m("info",arguments)};this._debug=function(){"debug"===x.logLevel&&m("debug",arguments)};this._isCrossDomain=function(a){return g.location&&g.location.host&&a?a!==g.location.host:!1};this.send=Z;this._getCallback=
function(a){return fa[a]};this._putCallback=function(a,c){var d=this._getCallback(a);b(c)&&(fa[a]=c);return d};this.onTransportFailure=function(a,b,c){this._debug("Transport failure",b,"for",a);var d=this.getTransportRegistry(),f=this.getURL(),g=this._isCrossDomain(e(f)[2]),l=d.findTransportTypes("1.0",g,f);"none"===b.action?"/meta/handshake"!==a.channel||b.transport||(d="Could not negotiate transport, client=["+l+"], server=["+a.supportedConnectionTypes+"]",this._warn(d),O(v.getType(),null,{reason:d,
connectionType:v.getType(),transport:v})):(b.delay=this.getBackoffPeriod(),"/meta/handshake"===a.channel?(b.transport||((d=d.negotiateTransport(l,"1.0",g,f))?(this._debug("Transport",v.getType(),"->",d.getType()),O(v.getType(),d.getType(),a.failure),b.action="handshake",b.transport=d):(this._warn("Could not negotiate transport, client=["+l+"]"),O(v.getType(),null,a.failure),b.action="none")),"none"!==b.action&&this.increaseBackoffPeriod()):(a=(new Date).getTime(),0===ca&&(ca=a),"retry"===b.action&&
(b.delay=this.increaseBackoffPeriod(),l=B.maxInterval,0<l&&a-ca+G>B.timeout+B.interval+l&&(b.action="handshake")),"handshake"===b.action&&(b.delay=0,d.reset(!1),this.resetBackoffPeriod())));c.call(h,b)};this.receive=Da;var Ka=function(a){h._debug("Received",a);for(var b=0;b<a.length;++b)Da(a[b])};var ua=function(a,b,c){h._debug("handleFailure",a,b,c);c.transport=a;for(a=0;a<b.length;++a){var d=b[a],e={id:d.id,successful:!1,channel:d.channel,failure:c};c.message=d;switch(d.channel){case "/meta/handshake":na(e,
{cause:"failure",action:"handshake",transport:null});break;case "/meta/connect":d=e;ya(d)?(ha=!1,za(d,{cause:"failure",action:"retry",transport:null})):h._debug("Mismatched /meta/connect failure",d);break;case "/meta/disconnect":Aa(e);break;case "/meta/subscribe":e.subscription=d.subscription;Ba(e);break;case "/meta/unsubscribe":e.subscription=d.subscription;Ca(e);break;default:oa(e)}}};this.registerTransport=function(a,c,d){if(d=H.add(a,c,d))this._debug("Registered transport",a),b(c.registered)&&
c.registered(a,this);return d};this.unregisterTransport=function(a){var c=H.remove(a);null!==c&&(this._debug("Unregistered transport",a),b(c.unregistered)&&c.unregistered());return c};this.unregisterTransports=function(){H.clear()};this.getTransportTypes=function(){return H.getTransportTypes()};this.findTransport=function(a){return H.find(a)};this.getTransportRegistry=function(){return H};this.configure=function(a){w.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=
function(a,b){if("disconnected"!==N)throw"Illegal state: handshaken";ra(a,b)};this.disconnect=function(a,c){if(!p()){b(a)&&(c=a,a=void 0);var d={id:""+ ++S,channel:"/meta/disconnect"};a=this._mixin(!1,{},a,d);h._putCallback(a.id,c);r("disconnecting");D([a],!1,"disconnect")}};this.startBatch=function(){++L;h._debug("Starting batch, depth",L)};this.endBatch=function(){--L;h._debug("Ending batch, depth",L);if(0>L)throw"Calls to startBatch() and endBatch() are not paired";0!==L||p()||ba||da()};this.batch=
function(a,b){a=Fa(a,b);this.startBatch();try{a.method.call(a.scope),this.endBatch()}catch(K){throw this._info("Exception during execution of batch",K),this.endBatch(),K;}};this.addListener=function(a,b,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";return Ga(a,b,c,!0)};this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+
a;k(a)};this.clearListeners=function(){I={}};this.subscribe=function(a,c,d,e,f){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(p())throw"Illegal state: disconnected";b(c)&&(f=e,e=d,d=c,c=void 0);b(e)&&(f=e,e=void 0);var g=!Ea(a),l=Ga(a,c,d,!1);g&&(g={id:""+ ++S,channel:"/meta/subscribe",subscription:a},g=this._mixin(!1,{},e,g),h._putCallback(g.id,f),Z(g));return l};this.unsubscribe=
function(a,c,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(p())throw"Illegal state: disconnected";b(c)&&(d=c,c=void 0);this.removeListener(a);var e=a.channel;Ea(e)||(e={id:""+ ++S,channel:"/meta/unsubscribe",subscription:e},e=this._mixin(!1,{},c,e),h._putCallback(e.id,d),Z(e))};this.resubscribe=function(a,b){a&&!a.listener&&k(a);if(a)return this.subscribe(a.channel,a.scope,a.callback,b)};this.clearSubscriptions=function(){A()};this.publish=function(a,
c,d,e){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(p())throw"Illegal state: disconnected";b(c)?(e=c,c={},d=void 0):b(d)&&(e=d,d=void 0);var f={id:""+ ++S,channel:a,data:c};f=this._mixin(!1,{},d,f);h._putCallback(f.id,e);Z(f)};this.publishBinary=function(a,c,d,e,f){b(c)?(f=c,c=new ArrayBuffer(0),d=!0,
e=void 0):b(d)?(f=d,d=!0,e=void 0):b(e)&&(f=e,e=void 0);this.publish(a,{meta:e,data:c,last:d},{ext:{binary:{}}},f)};this.remoteCall=function(a,c,d,e,f){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: target must be a string";if(p())throw"Illegal state: disconnected";b(c)?(f=c,c={},d=x.maxNetworkDelay,e=void 0):b(d)?(f=d,d=x.maxNetworkDelay,e=void 0):b(e)&&(f=e,e=void 0);if("number"!==typeof d)throw"Illegal argument type: timeout must be a number";
a.match(/^\//)||(a="/"+a);var g={id:""+ ++S,channel:"/service"+a,data:c},k=this._mixin(!1,{},e,g);g={callback:f};0<d&&(g.timeout=h.setTimeout(function(){h._debug("Timing out remote call",k,"after",d,"ms");oa({id:k.id,error:"406::timeout",successful:!1,failure:{message:k,reason:"Remote Call Timeout"}})},d),h._debug("Scheduled remote call timeout",k,"in",d,"ms"));ma[k.id]=g;Z(k)};this.remoteCallBinary=function(a,c,d,e,f,g){b(c)?(g=c,c=new ArrayBuffer(0),d=!0,e=void 0,f=x.maxNetworkDelay):b(d)?(g=d,
d=!0,e=void 0,f=x.maxNetworkDelay):b(e)?(g=e,e=void 0,f=x.maxNetworkDelay):b(f)&&(g=f,f=x.maxNetworkDelay);this.remoteCall(a,{meta:e,data:c,last:d},f,{ext:{binary:{}}},g)};this.getStatus=function(){return N};this.isDisconnected=p;this.setBackoffIncrement=function(a){x.backoffIncrement=a};this.getBackoffIncrement=function(){return x.backoffIncrement};this.getBackoffPeriod=function(){return G};this.increaseBackoffPeriod=function(){G<x.maxBackoff&&(G+=x.backoffIncrement);return G};this.resetBackoffPeriod=
function(){G=0};this.setLogLevel=function(a){x.logLevel=a};this.registerExtension=function(a,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var d=!1,e=0;e<E.length;++e)if(E[e].name===a){d=!0;break}if(d)return this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1;E.push({name:a,extension:c});this._debug("Registered extension",
a);b(c.registered)&&c.registered(a,this);return!0};this.unregisterExtension=function(a){if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<E.length;++d){var e=E[d];if(e.name===a){E.splice(d,1);c=!0;this._debug("Unregistered extension",a);a=e.extension;b(a.unregistered)&&a.unregistered();break}}return c};this.getExtension=function(a){for(var b=0;b<E.length;++b){var c=E[b];if(c.name===a)return c.extension}return null};this.getName=function(){return Oa};
this.getClientId=function(){return V};this.getURL=function(){if(v){var a=v.getURL();if(a||(a=x.urls[v.getType()]))return a}return x.url};this.getTransport=function(){return v};this.getConfiguration=function(){return this._mixin(!0,{},x)};this.getAdvice=function(){return this._mixin(!0,{},B)};this.setTimeout=function(a,b){return P.setTimeout(function(){try{h._debug("Invoking timed function",a),a()}catch(K){h._debug("Exception invoking timed function",a,K)}},b)};this.clearTimeout=function(a){P.clearTimeout(a)};
g.WebSocket&&this.registerTransport("websocket",new ta);this.registerTransport("long-polling",new pa);this.registerTransport("callback-polling",new qa)},Transport:C,RequestTransport:T,LongPollingTransport:pa,CallbackPollingTransport:qa,WebSocketTransport:ta,Utils:q,Z85:{encode:function(f){var d=null;f instanceof ArrayBuffer?d=f:f.buffer instanceof ArrayBuffer?d=f.buffer:Array.isArray(f)&&(d=(new Uint8Array(f)).buffer);if(null==d)throw"Cannot Z85 encode "+f;f=d.byteLength;var b=f%4;b=4-(0===b?4:b);
d=new DataView(d);for(var c="",g=0,e=0;e<f+b;++e){var n=e>=f;g=256*g+(n?0:d.getUint8(e));if(0===(e+1)%4){for(var k=52200625,q=5;0<q;--q){if(!n||q>b)c+=O[Math.floor(g/k)%85];k/=85}g=0}}return c},decode:function(f){var d=f.length%5,b=5-(0===d?5:d);for(d=0;d<b;++d)f+=O[O.length-1];d=f.length;b=new ArrayBuffer(4*d/5-b);for(var c=new DataView(b),g=0,e=0,n=0,k=0;k<d;++k){var q=f.charCodeAt(e++)-32;g=85*g+ia[q];if(0===e%5){for(q=16777216;1<=q;)n<c.byteLength&&c.setUint8(n++,Math.floor(g/q)%256),q/=256;g=
0}}return b}}}});
